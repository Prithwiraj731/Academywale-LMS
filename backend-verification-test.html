<!DOCTYPE html>
<html>
<head>
    <title>Backend Route Verification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        button { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Backend Route Verification Test</h1>
    <p>Testing your deployed backend on Render to see what's actually available...</p>
    
    <div class="test-section">
        <h3>üì° Testing Deployed Backend Routes</h3>
        <button onclick="testAllRoutes()">Test All Routes</button>
        <button onclick="testCourseCreation()">Test Course Creation</button>
        <div id="routeResults"></div>
    </div>

    <div class="test-section">
        <h3>üóÉÔ∏è Database Connection Test</h3>
        <button onclick="testDatabase()">Test Database Operations</button>
        <div id="dbResults"></div>
    </div>

    <script>
    const BASE_URL = 'https://academywale-lms.onrender.com';

    async function testAllRoutes() {
        const results = document.getElementById('routeResults');
        results.innerHTML = '<p>üîÑ Testing routes...</p>';
        
        const routes = [
            { method: 'GET', path: '/health', name: 'Health Check' },
            { method: 'GET', path: '/api/auth/test', name: 'Auth Test' },
            { method: 'GET', path: '/api/courses/all', name: 'Get All Courses' },
            { method: 'GET', path: '/api/courses/standalone', name: 'Get Standalone Courses' },
            { method: 'OPTIONS', path: '/api/admin/courses/standalone', name: 'Course Creation Endpoint Check' },
            { method: 'GET', path: '/api/admin/faculties', name: 'Get Faculties' },
            { method: 'GET', path: '/api/admin/institutes', name: 'Get Institutes' }
        ];

        for (const route of routes) {
            try {
                const response = await fetch(BASE_URL + route.path, { 
                    method: route.method,
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    results.innerHTML += `<div class="result success">‚úÖ ${route.name}: ${response.status} - Working</div>`;
                } else if (response.status === 404) {
                    results.innerHTML += `<div class="result error">‚ùå ${route.name}: 404 - Route Not Found</div>`;
                } else if (response.status === 405) {
                    results.innerHTML += `<div class="result warning">üî∂ ${route.name}: 405 - Method not allowed (but route exists)</div>`;
                } else {
                    results.innerHTML += `<div class="result warning">‚ö†Ô∏è ${route.name}: ${response.status} - ${response.statusText}</div>`;
                }
            } catch (error) {
                results.innerHTML += `<div class="result error">‚ùå ${route.name}: Network Error - ${error.message}</div>`;
            }
        }
    }

    async function testCourseCreation() {
        const results = document.getElementById('routeResults');
        results.innerHTML += '<h4>üß™ Testing Course Creation Endpoint...</h4>';
        
        try {
            // Test with minimal required data
            const formData = new FormData();
            formData.append('subject', 'Test Subject');
            formData.append('category', 'CA');
            formData.append('subcategory', 'Foundation');
            formData.append('paperId', '1');
            formData.append('isStandalone', 'true');
            formData.append('title', 'Test Course');
            
            const response = await fetch(BASE_URL + '/api/admin/courses/standalone', {
                method: 'POST',
                body: formData
            });
            
            const responseText = await response.text();
            
            if (response.ok) {
                results.innerHTML += `<div class="result success">‚úÖ Course Creation: Working! Status ${response.status}</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            } else if (response.status === 404) {
                results.innerHTML += `<div class="result error">‚ùå Course Creation: 404 - Endpoint does not exist on deployed backend</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            } else {
                results.innerHTML += `<div class="result warning">‚ö†Ô∏è Course Creation: Status ${response.status}</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            }
        } catch (error) {
            results.innerHTML += `<div class="result error">‚ùå Course Creation: Network Error - ${error.message}</div>`;
        }
    }

    async function testDatabase() {
        const results = document.getElementById('dbResults');
        results.innerHTML = '<p>üîÑ Testing database operations...</p>';
        
        try {
            // Test fetching existing courses
            const coursesResponse = await fetch(BASE_URL + '/api/courses/all');
            if (coursesResponse.ok) {
                const coursesData = await coursesResponse.json();
                results.innerHTML += `<div class="result success">‚úÖ Database Read: Working - Found ${coursesData.courses ? coursesData.courses.length : 0} courses</div>`;
            } else {
                results.innerHTML += `<div class="result error">‚ùå Database Read: Failed - Status ${coursesResponse.status}</div>`;
            }
            
            // Test fetching faculties
            const facultiesResponse = await fetch(BASE_URL + '/api/admin/faculties');
            if (facultiesResponse.ok) {
                const facultiesData = await facultiesResponse.json();
                results.innerHTML += `<div class="result success">‚úÖ Faculty Data: Working - Found ${facultiesData.faculties ? facultiesData.faculties.length : 0} faculties</div>`;
            } else {
                results.innerHTML += `<div class="result error">‚ùå Faculty Data: Failed - Status ${facultiesResponse.status}</div>`;
            }
            
        } catch (error) {
            results.innerHTML += `<div class="result error">‚ùå Database Test: Network Error - ${error.message}</div>`;
        }
    }

    // Auto-run basic test on load
    window.onload = () => {
        testAllRoutes();
    };
    </script>
</body>
</html>
