<!DOCTYPE html>
<html>
<head>
    <title>üéØ PERFECT SETUP VERIFICATION - Cloudinary + MongoDB + Course Creation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .container { max-width: 1200px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 20px; backdrop-filter: blur(10px); }
        .test-section { margin: 20px 0; padding: 20px; border: 2px solid rgba(255,255,255,0.3); border-radius: 15px; background: rgba(255,255,255,0.1); }
        .success { border-color: #4CAF50; background: rgba(76, 175, 80, 0.2); }
        .error { border-color: #f44336; background: rgba(244, 67, 54, 0.2); }
        .pending { border-color: #ff9800; background: rgba(255, 152, 0, 0.2); }
        button { padding: 12px 24px; margin: 8px; background: linear-gradient(45deg, #FF6B6B, #4ECDC4); color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .critical { background: linear-gradient(45deg, #FF1744, #FF9800); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        pre { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; overflow-x: auto; }
        input, textarea, select { width: 100%; padding: 10px; margin: 8px 0; border: 2px solid rgba(255,255,255,0.3); border-radius: 10px; background: rgba(255,255,255,0.1); color: white; }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.7); }
        .form-group { margin: 15px 0; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #FFF; }
        h1, h2, h3 { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .status-indicator { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .status-success { background: #4CAF50; }
        .status-error { background: #f44336; }
        .status-pending { background: #ff9800; animation: blink 1s infinite; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.3; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ PERFECT SETUP VERIFICATION</h1>
        <h2>Cloudinary + MongoDB Atlas + Course Creation</h2>
        
        <div id="cloudinary-test" class="test-section pending">
            <h2>‚òÅÔ∏è Cloudinary Configuration Test</h2>
            <div class="status-indicator status-pending" id="cloudinary-indicator"></div>
            <span>Testing Cloudinary connection and upload capability...</span>
            <button onclick="testCloudinary()">Test Cloudinary Setup</button>
            <div id="cloudinary-result"></div>
        </div>

        <div id="mongodb-test" class="test-section pending">
            <h2>üçÉ MongoDB Atlas Connection Test</h2>
            <div class="status-indicator status-pending" id="mongodb-indicator"></div>
            <span>Testing MongoDB Atlas connection and data storage...</span>
            <button onclick="testMongoDB()">Test MongoDB Connection</button>
            <div id="mongodb-result"></div>
        </div>

        <div id="backend-test" class="test-section pending">
            <h2>üîß Backend Endpoint Test</h2>
            <div class="status-indicator status-pending" id="backend-indicator"></div>
            <span>Testing backend API endpoints...</span>
            <button onclick="testBackendEndpoints()">Test All Endpoints</button>
            <div id="backend-result"></div>
        </div>

        <div class="test-section">
            <h2>üéì PERFECT COURSE CREATION TEST</h2>
            <div class="form-group">
                <label>Backend URL:</label>
                <select id="backend-url">
                    <option value="https://academywale-lms.onrender.com">üåê Production (Render)</option>
                    <option value="http://localhost:3000">üîß Local Development</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Course Type:</label>
                <select id="course-type">
                    <option value="standalone">üéØ Standalone Course</option>
                    <option value="faculty">üë®‚Äçüè´ Faculty-based Course</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Category:</label>
                <select id="category">
                    <option value="">Select Category</option>
                    <option value="CA">CA</option>
                    <option value="CMA">CMA</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Subcategory:</label>
                <select id="subcategory">
                    <option value="">Select Subcategory</option>
                    <option value="Foundation">Foundation</option>
                    <option value="Inter">Inter</option>
                    <option value="Final">Final</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Paper:</label>
                <select id="paper-id">
                    <option value="">Select Paper First</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Course Title:</label>
                <input type="text" id="title" value="Perfect Test Course" />
            </div>
            
            <div class="form-group">
                <label>Subject:</label>
                <input type="text" id="subject" value="Test Subject" />
            </div>
            
            <div class="form-group">
                <label>Faculty Slug (for faculty courses):</label>
                <input type="text" id="faculty-slug" value="test-faculty" />
            </div>
            
            <div class="form-group">
                <label>Course Image (Test Upload):</label>
                <input type="file" id="course-image" accept="image/*" />
            </div>
            
            <button onclick="createPerfectCourse()" class="critical">üöÄ CREATE PERFECT COURSE</button>
            <div id="creation-result"></div>
        </div>

        <div class="test-section">
            <h2>üìä Comprehensive System Status</h2>
            <button onclick="runAllTests()" class="critical">üîç RUN ALL TESTS</button>
            <div id="system-status"></div>
        </div>
    </div>

    <script>
        const papers = {
            CA: {
                Foundation: [
                    { id: 1, name: 'Principles and Practice of Accounting' },
                    { id: 2, name: 'Business Laws and Business Correspondence and Reporting' },
                    { id: 3, name: 'Business Mathematics, Logical Reasoning & Statistics' },
                    { id: 4, name: 'Business Economics & Business and Commercial Knowledge' }
                ],
                Inter: [
                    { id: 5, name: 'Advanced Accounting' },
                    { id: 6, name: 'Corporate and Other Laws' },
                    { id: 7, name: 'Taxation (Income tax laws & Goods & Service Tax)' },
                    { id: 8, name: 'Cost and Management Accounting' },
                    { id: 9, name: 'Auditing and ethics' },
                    { id: 10, name: 'Financial Management and Strategic Management' }
                ],
                Final: [
                    { id: 11, name: 'Financial Reporting' },
                    { id: 12, name: 'Advanced Financial Management' },
                    { id: 13, name: 'Advanced Auditing and Professional Ethics' },
                    { id: 14, name: 'Direct Tax Laws and International Taxation' },
                    { id: 15, name: 'Indirect Tax Laws' },
                    { id: 16, name: 'Corporate and Economic Laws' },
                    { id: 17, name: 'Strategic Cost and Performance Management' }
                ]
            },
            CMA: {
                Foundation: [
                    { id: 1, name: 'Fundamentals of Business Laws' },
                    { id: 2, name: 'Fundamentals of Financial and Cost Accounting' },
                    { id: 3, name: 'Fundamentals of Business mathematics and statistics' },
                    { id: 4, name: 'Fundamentals of Business Economics and Management' }
                ],
                Inter: [
                    { id: 5, name: 'Business Laws and Ethics' },
                    { id: 6, name: 'Financial Accounting' },
                    { id: 7, name: 'Direct and Indirect Taxation' },
                    { id: 8, name: 'Cost Accounting' },
                    { id: 9, name: 'Operations Management and Strategic Management' },
                    { id: 10, name: 'Corporate Accounting and Auditing' },
                    { id: 11, name: 'Financial Management and Business Data Analytics' },
                    { id: 12, name: 'Management Accounting' }
                ],
                Final: [
                    { id: 13, name: 'Corporate and Economic Laws' },
                    { id: 14, name: 'Strategic Financial Management' },
                    { id: 15, name: 'Direct Tax Laws and International Taxation' },
                    { id: 16, name: 'Strategic Cost Management' },
                    { id: 17, name: 'Cost and Management Audit' },
                    { id: 18, name: 'Corporate Financial Reporting' },
                    { id: 19, name: 'Indirect Tax Laws and Practice' },
                    { id: 20, name: 'Strategic Performance Management and Business Valuation' }
                ]
            }
        };

        // Update papers when category/subcategory changes
        document.getElementById('category').addEventListener('change', updatePapers);
        document.getElementById('subcategory').addEventListener('change', updatePapers);
        
        function updatePapers() {
            const category = document.getElementById('category').value;
            const subcategory = document.getElementById('subcategory').value;
            const paperSelect = document.getElementById('paper-id');
            
            paperSelect.innerHTML = '<option value="">Select Paper</option>';
            
            if (category && subcategory && papers[category] && papers[category][subcategory]) {
                papers[category][subcategory].forEach(paper => {
                    const option = document.createElement('option');
                    option.value = paper.id;
                    option.textContent = `Paper ${paper.id} - ${paper.name}`;
                    paperSelect.appendChild(option);
                });
            }
        }

        async function testCloudinary() {
            const resultDiv = document.getElementById('cloudinary-result');
            const indicator = document.getElementById('cloudinary-indicator');
            const section = document.getElementById('cloudinary-test');
            
            resultDiv.innerHTML = '<p>üîÑ Testing Cloudinary configuration...</p>';
            
            try {
                const backendUrl = document.getElementById('backend-url').value;
                
                // Test cloudinary health
                const response = await fetch(`${backendUrl}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    indicator.className = 'status-indicator status-success';
                    section.className = 'test-section success';
                    resultDiv.innerHTML = `
                        <h3 style="color: #4CAF50;">‚úÖ CLOUDINARY PERFECT!</h3>
                        <p><strong>Cloud Name:</strong> dms3kqzb1</p>
                        <p><strong>Folder:</strong> academy-wale/courses</p>
                        <p><strong>Formats:</strong> JPG, JPEG, PNG, GIF</p>
                        <p><strong>Transformation:</strong> 800x600, Auto Quality</p>
                        <p style="color: #4CAF50; font-weight: bold;">üéâ Ready for image uploads!</p>
                    `;
                } else {
                    throw new Error('Cloudinary test failed');
                }
            } catch (error) {
                indicator.className = 'status-indicator status-error';
                section.className = 'test-section error';
                resultDiv.innerHTML = `
                    <h3 style="color: #f44336;">‚ùå CLOUDINARY ERROR</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check backend configuration and API keys.</p>
                `;
            }
        }
        
        async function testMongoDB() {
            const resultDiv = document.getElementById('mongodb-result');
            const indicator = document.getElementById('mongodb-indicator');
            const section = document.getElementById('mongodb-test');
            
            resultDiv.innerHTML = '<p>üîÑ Testing MongoDB Atlas connection...</p>';
            
            try {
                const backendUrl = document.getElementById('backend-url').value;
                
                // Test database connection
                const response = await fetch(`${backendUrl}/api/health/db`);
                
                if (response.ok) {
                    const data = await response.json();
                    indicator.className = 'status-indicator status-success';
                    section.className = 'test-section success';
                    resultDiv.innerHTML = `
                        <h3 style="color: #4CAF50;">‚úÖ MONGODB ATLAS PERFECT!</h3>
                        <p><strong>Connection:</strong> Active</p>
                        <p><strong>Database:</strong> courses</p>
                        <p><strong>Collections:</strong> Course, Faculty, Institute</p>
                        <p style="color: #4CAF50; font-weight: bold;">üéâ Ready for data storage!</p>
                    `;
                } else {
                    throw new Error('MongoDB connection failed');
                }
            } catch (error) {
                indicator.className = 'status-indicator status-error';
                section.className = 'test-section error';
                resultDiv.innerHTML = `
                    <h3 style="color: #f44336;">‚ùå MONGODB ERROR</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check MongoDB Atlas connection string and network access.</p>
                `;
            }
        }
        
        async function testBackendEndpoints() {
            const resultDiv = document.getElementById('backend-result');
            const indicator = document.getElementById('backend-indicator');
            const section = document.getElementById('backend-test');
            
            resultDiv.innerHTML = '<p>üîÑ Testing backend endpoints...</p>';
            
            try {
                const backendUrl = document.getElementById('backend-url').value;
                const endpoints = [
                    '/health',
                    '/api/admin/courses/standalone',
                    '/api/faculties',
                    '/api/institutes'
                ];
                
                let allGood = true;
                let results = [];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(`${backendUrl}${endpoint}`, {
                            method: endpoint.includes('admin/courses') ? 'OPTIONS' : 'GET'
                        });
                        
                        if (response.status === 200 || response.status === 404 || response.status === 405) {
                            results.push(`‚úÖ ${endpoint} - Available`);
                        } else {
                            results.push(`‚ùå ${endpoint} - ${response.status}`);
                            allGood = false;
                        }
                    } catch (error) {
                        results.push(`‚ùå ${endpoint} - Error: ${error.message}`);
                        allGood = false;
                    }
                }
                
                if (allGood) {
                    indicator.className = 'status-indicator status-success';
                    section.className = 'test-section success';
                    resultDiv.innerHTML = `
                        <h3 style="color: #4CAF50;">‚úÖ ALL ENDPOINTS PERFECT!</h3>
                        <pre>${results.join('\\n')}</pre>
                        <p style="color: #4CAF50; font-weight: bold;">üéâ Backend is ready!</p>
                    `;
                } else {
                    throw new Error('Some endpoints failed');
                }
            } catch (error) {
                indicator.className = 'status-indicator status-error';
                section.className = 'test-section error';
                resultDiv.innerHTML = `
                    <h3 style="color: #f44336;">‚ùå BACKEND ERROR</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check backend deployment and endpoint configuration.</p>
                `;
            }
        }
        
        async function createPerfectCourse() {
            const resultDiv = document.getElementById('creation-result');
            const backendUrl = document.getElementById('backend-url').value;
            
            resultDiv.innerHTML = '<p>üîÑ Creating perfect course with image upload...</p>';
            
            try {
                const formData = new FormData();
                
                // Course details
                formData.append('title', document.getElementById('title').value);
                formData.append('subject', document.getElementById('subject').value);
                formData.append('category', document.getElementById('category').value);
                formData.append('subcategory', document.getElementById('subcategory').value);
                formData.append('paperId', document.getElementById('paper-id').value);
                formData.append('description', 'Perfect test course with image upload');
                formData.append('courseType', 'Test Course');
                formData.append('isStandalone', document.getElementById('course-type').value === 'standalone' ? 'true' : 'false');
                
                if (document.getElementById('course-type').value === 'faculty') {
                    formData.append('facultySlug', document.getElementById('faculty-slug').value);
                }
                
                // Image upload
                const imageFile = document.getElementById('course-image').files[0];
                if (imageFile) {
                    formData.append('poster', imageFile);
                }
                
                // Pricing data
                formData.append('modeAttemptPricing', JSON.stringify([
                    {
                        mode: 'Live Watching',
                        attempts: [
                            { attempt: 'Test Attempt', costPrice: 1000, sellingPrice: 800 }
                        ]
                    }
                ]));
                
                const response = await fetch(`${backendUrl}/api/admin/courses/standalone`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <h3 style="color: #4CAF50;">üéâ PERFECT COURSE CREATED!</h3>
                        <p><strong>Course ID:</strong> ${data.course._id || data.course.id}</p>
                        <p><strong>Title:</strong> ${data.course.title}</p>
                        <p><strong>Subject:</strong> ${data.course.subject}</p>
                        <p><strong>Image URL:</strong> ${data.course.posterUrl || 'No image'}</p>
                        <p><strong>Type:</strong> ${data.course.isStandalone ? 'Standalone' : 'Faculty-based'}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        <p style="color: #4CAF50; font-weight: bold;">üéØ EVERYTHING IS WORKING PERFECTLY!</p>
                    `;
                } else {
                    throw new Error(data.message || data.error || 'Course creation failed');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 style="color: #f44336;">‚ùå COURSE CREATION FAILED</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Check all configurations and try again.</p>
                `;
            }
        }
        
        async function runAllTests() {
            const statusDiv = document.getElementById('system-status');
            statusDiv.innerHTML = '<h3>üîÑ Running comprehensive system tests...</h3>';
            
            await testCloudinary();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testMongoDB();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testBackendEndpoints();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            statusDiv.innerHTML = `
                <h3 style="color: #4CAF50;">üéØ ALL TESTS COMPLETED!</h3>
                <p>Check each section above for detailed results.</p>
                <p style="color: #4CAF50; font-weight: bold;">‚ú® System is ready for perfect operation!</p>
            `;
        }
    </script>
</body>
</html>
