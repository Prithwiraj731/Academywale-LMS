<!DOCTYPE html>
<html>
<head>
    <title>Direct Backend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; border-left: 5px solid #28a745; }
        .error { background: #f8d7da; border-left: 5px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 5px solid #ffc107; }
        .info { background: #d1ecf1; border-left: 5px solid #17a2b8; }
        button { background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #0056b3; }
        .code { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; margin: 10px 0; white-space: pre-wrap; }
        h1 { color: #333; text-align: center; }
        h3 { color: #555; margin-top: 30px; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 3px; font-weight: bold; }
        .status.working { background: #28a745; color: white; }
        .status.not-found { background: #dc3545; color: white; }
        .status.method-not-allowed { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Direct Backend Endpoint Test</h1>
        <p><strong>Testing:</strong> https://academywale-lms.onrender.com</p>
        
        <h3>üì° Quick Health Check</h3>
        <button onclick="quickHealthCheck()">Run Health Check</button>
        <div id="healthResults"></div>
        
        <h3>üéØ Course Creation Endpoint Test</h3>
        <button onclick="testCourseEndpoint()">Test Course Creation Endpoint</button>
        <div id="courseResults"></div>
        
        <h3>üß™ Create Test Course</h3>
        <button onclick="createTestCourse()">Try Creating Test Course</button>
        <div id="testCourseResults"></div>
        
        <h3>üìä Database Verification</h3>
        <button onclick="verifyDatabase()">Check Database Contents</button>
        <div id="dbResults"></div>
    </div>

    <script>
    const BASE_URL = 'https://academywale-lms.onrender.com';

    async function quickHealthCheck() {
        const results = document.getElementById('healthResults');
        results.innerHTML = '<p>üîÑ Checking server health...</p>';
        
        try {
            const response = await fetch(BASE_URL + '/health');
            if (response.ok) {
                const data = await response.text();
                results.innerHTML = `<div class="result success">‚úÖ Server is online and responding</div><div class="code">${data}</div>`;
            } else {
                results.innerHTML = `<div class="result error">‚ùå Server responded with status: ${response.status}</div>`;
            }
        } catch (error) {
            results.innerHTML = `<div class="result error">‚ùå Server is not responding: ${error.message}</div>`;
        }
    }

    async function testCourseEndpoint() {
        const results = document.getElementById('courseResults');
        results.innerHTML = '<p>üîÑ Testing course creation endpoint...</p>';
        
        const endpoints = [
            '/api/admin/courses/standalone',
            '/api/admin/courses',
            '/api/admin/courses/new',
            '/api/courses/all'
        ];
        
        for (const endpoint of endpoints) {
            try {
                console.log('Testing:', BASE_URL + endpoint);
                const response = await fetch(BASE_URL + endpoint, { method: 'OPTIONS' });
                const status = response.status;
                
                if (status === 200 || status === 204) {
                    results.innerHTML += `<div class="result success">‚úÖ ${endpoint} - <span class="status working">AVAILABLE</span></div>`;
                } else if (status === 404) {
                    results.innerHTML += `<div class="result error">‚ùå ${endpoint} - <span class="status not-found">NOT FOUND</span></div>`;
                } else if (status === 405) {
                    results.innerHTML += `<div class="result warning">‚ö†Ô∏è ${endpoint} - <span class="status method-not-allowed">EXISTS (Method not allowed)</span></div>`;
                } else {
                    results.innerHTML += `<div class="result info">‚ÑπÔ∏è ${endpoint} - Status: ${status}</div>`;
                }
            } catch (error) {
                results.innerHTML += `<div class="result error">‚ùå ${endpoint} - Network error: ${error.message}</div>`;
            }
        }
    }

    async function createTestCourse() {
        const results = document.getElementById('testCourseResults');
        results.innerHTML = '<p>üîÑ Attempting to create a test course...</p>';
        
        try {
            const formData = new FormData();
            formData.append('subject', 'Test Subject');
            formData.append('category', 'CA');
            formData.append('subcategory', 'Foundation');
            formData.append('paperId', '1');
            formData.append('paperName', 'Test Paper');
            formData.append('isStandalone', 'true');
            formData.append('title', 'Test Course Title');
            formData.append('description', 'This is a test course');
            formData.append('modeAttemptPricing', JSON.stringify([{
                mode: 'Test Mode',
                attempts: [{ attempt: 'Test Attempt', costPrice: 1000, sellingPrice: 800 }]
            }]));
            
            console.log('Sending test course data to:', BASE_URL + '/api/admin/courses/standalone');
            
            const response = await fetch(BASE_URL + '/api/admin/courses/standalone', {
                method: 'POST',
                body: formData
            });
            
            const responseText = await response.text();
            console.log('Response status:', response.status);
            console.log('Response text:', responseText);
            
            if (response.ok) {
                results.innerHTML += `<div class="result success">‚úÖ Test course created successfully!</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            } else if (response.status === 404) {
                results.innerHTML += `<div class="result error">‚ùå Endpoint not found (404) - Your deployed backend doesn't have this route</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            } else {
                results.innerHTML += `<div class="result warning">‚ö†Ô∏è Course creation failed with status: ${response.status}</div>`;
                results.innerHTML += `<div class="code">Response: ${responseText}</div>`;
            }
        } catch (error) {
            results.innerHTML += `<div class="result error">‚ùå Network error: ${error.message}</div>`;
        }
    }

    async function verifyDatabase() {
        const results = document.getElementById('dbResults');
        results.innerHTML = '<p>üîÑ Checking database contents...</p>';
        
        try {
            // Check existing courses
            const coursesResponse = await fetch(BASE_URL + '/api/courses/all');
            if (coursesResponse.ok) {
                const coursesData = await coursesResponse.json();
                results.innerHTML += `<div class="result success">‚úÖ Database connection working</div>`;
                results.innerHTML += `<div class="result info">üìä Found ${coursesData.courses ? coursesData.courses.length : 0} existing courses</div>`;
                
                if (coursesData.courses && coursesData.courses.length > 0) {
                    results.innerHTML += `<div class="code">Sample course: ${JSON.stringify(coursesData.courses[0], null, 2)}</div>`;
                }
            } else {
                results.innerHTML += `<div class="result error">‚ùå Failed to fetch courses: ${coursesResponse.status}</div>`;
            }
            
            // Check faculties
            const facultiesResponse = await fetch(BASE_URL + '/api/admin/faculties');
            if (facultiesResponse.ok) {
                const facultiesData = await facultiesResponse.json();
                results.innerHTML += `<div class="result success">‚úÖ Found ${facultiesData.faculties ? facultiesData.faculties.length : 0} faculties in database</div>`;
            } else {
                results.innerHTML += `<div class="result warning">‚ö†Ô∏è Faculty endpoint responded with: ${facultiesResponse.status}</div>`;
            }
            
        } catch (error) {
            results.innerHTML += `<div class="result error">‚ùå Database check failed: ${error.message}</div>`;
        }
    }

    // Auto-run basic test
    window.onload = () => {
        quickHealthCheck();
        setTimeout(testCourseEndpoint, 1000);
    };
    </script>
</body>
</html>
